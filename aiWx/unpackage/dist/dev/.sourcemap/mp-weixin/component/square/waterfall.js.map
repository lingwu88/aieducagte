<<<<<<< HEAD
{"version":3,"sources":[null,"webpack:///D:/Project/Ai/aieducagte/aiWx/component/square/waterfall.vue?0c1d","webpack:///D:/Project/Ai/aieducagte/aiWx/component/square/waterfall.vue?a969","webpack:///D:/Project/Ai/aieducagte/aiWx/component/square/waterfall.vue?010d","uni-app:///component/square/waterfall.vue","webpack:///D:/Project/Ai/aieducagte/aiWx/component/square/waterfall.vue?2a17","webpack:///D:/Project/Ai/aieducagte/aiWx/component/square/waterfall.vue?512e"],"names":["data","IVirtualWaterFallProps","gap","column","pageSize","request","ICardItem","id","width","height","computed","onLoad","methods"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkI;AAClI;AAC6D;AACL;AACsC;;;AAG9F;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,+EAAM;AACR,EAAE,gGAAM;AACR,EAAE,yGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAmmB,CAAgB,6nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCWvnB;EACAA;IACA;MACAC;QACAC;QACAC;QACAC;QACAC;UAAA;QAAA;MACA;MACAC;QACAC;QACAC;QACAC;MACA;IACA;EACA;EACAC,WAEA;EACAC,2BAEA;EACAC,UACA;AACA;AAAA,2B;;;;;;;;;;;;ACnCA;AAAA;AAAA;AAAA;AAAsqC,CAAgB,4oCAAG,EAAC,C;;;;;;;;;;;ACA1rC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"component/square/waterfall.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./waterfall.vue?vue&type=template&id=37ce5880&scoped=true&\"\nvar renderjs\nimport script from \"./waterfall.vue?vue&type=script&lang=js&\"\nexport * from \"./waterfall.vue?vue&type=script&lang=js&\"\nimport style0 from \"./waterfall.vue?vue&type=style&index=0&id=37ce5880&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"37ce5880\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"component/square/waterfall.vue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./waterfall.vue?vue&type=template&id=37ce5880&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./waterfall.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./waterfall.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"container\">\r\n    <view class=\"list\">\r\n      <view class=\"item\">\r\n        <slot name=\"item\"></slot>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n        IVirtualWaterFallProps:{\r\n          gap:10,\r\n          column:3,\r\n          pageSize:number,\r\n          request:(page,pageSize)=>Promise\r\n        },\r\n        ICardItem:{\r\n          id:1,\r\n          width:100,\r\n          height:200\r\n        }\r\n\t\t\t}\r\n\t\t},\r\n    computed:{\r\n\r\n    },\r\n\t\tonLoad() {\r\n\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container{\r\n  width:100%;\r\n  height:100%;\r\n  overflow-y:scroll;\r\n  overflow-x:hidden;\r\n\r\n  .list{\r\n    position:relative;\r\n    width:100%;\r\n\r\n    .item{\r\n      position:absolute;\r\n      top:0;\r\n      left:0;\r\n      box-sizing:border-box;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./waterfall.vue?vue&type=style&index=0&id=37ce5880&lang=scss&scoped=true&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./waterfall.vue?vue&type=style&index=0&id=37ce5880&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1737105472975\n      var cssReload = require(\"E:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}
=======
{"version":3,"sources":[null,"webpack:///E:/project/AiEducate/aiWx/component/square/waterfall.vue?44e7","webpack:///E:/project/AiEducate/aiWx/component/square/waterfall.vue?036d","uni-app:///component/square/waterfall.vue"],"names":["props","type","required","data","item","imageHeight","dataState","loading","isFinish","currentPage","list","scrollState","viewWidth","viewHeight","start","queueState","queue","height","len","isShow","containerRef","resizeObserver","temporaryList","itemSizeInfo","onLoad","methods","handleResize","console","setItemSize","pre","width","updateItemSize","h","addInQueue","currentColumn","generatorItem","y","style","transform","loadDataList","handleScroll","scrollTop","clientHeight","reComputedQueue","mountTemporaryList","query","Array","initScrollState","init","computed","hasMoreData","end","cardList","renderList","i","computedHeight","minHeight","maxHeight","minIndex","listStyle","watch","handler","mounted","container","beforeDestroy"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkI;AAClI;AAC6D;AACL;;;AAGxD;AACiL;AACjL,gBAAgB,wLAAU;AAC1B,EAAE,+EAAM;AACR,EAAE,gGAAM;AACR,EAAE,yGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAA4qB,CAAgB,0qBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;ACsBhsB;AAAA;AAAA;AAAA,eACA;EACAA;IACAA;MACAC;MACAC;IACA;EACA;EACAC;IACA;MACAC;MACAC;MACA;MACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACA;MACAC;QACAC;QACAC;QACAC;MACA;MACA;MACAC;QACAC;UAAA;YAAAN;YAAAO;UAAA;QAAA;QACAC;MACA;MACAC;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACAC;IACA;EACA;EACAC,2BAEA;EACAC;IACA;IACAC;MACAC;MACA;MACA;IACA;IACA;IACAC;MAAA;MACA;QACA;QACA;QACAC;UACAC;UACAb;UACAZ;QACA;QACA;MACA;IACA;IACA;IACA0B;MAAA;MACA;QAAA;UAAAC;QACA;QACA;UAAAf;QAAA;MACA;IACA;IACA;IACAgB;MAAA;MACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACAC;QACAA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA,YACAC;MACA;MACA;QACAhC;QACAgC;QACAJ;QACA3B;QACAgC;UACAP;UACAb;UACAqB;QACA;MACA;IACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,KACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACA;gBAAA;gBAAA,OACA;cAAA;gBAAA7B;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBACA;gBAAA;cAAA;gBAGA;gBACA;gBAAA,iCACAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA8B;MAAA;MACA;MACA;QAAAC;QAAAC;MACA;MACA;QACA;UACAxB;UACAA;QACA;QACA;MACA;MACA;QACA;MACA;IACA;IACAyB;MACA;MACA;QAAA;UAAAjC;UAAAO;QAAA;MAAA;MACA;MACA;MACA;IACA;IACA2B;MAAA;MACA,uBACA;MACA;MACA;QACA;QACA,WACA;QACA;QACA;UACAxC;UACAgC;UACAJ;UACA3B;UACAgC;YACAP;UACA;QACA;MACA;MAEA;QACA;QACAe;UACA;UACA;YACA;YACAC;cACA;cACA;YACA;UACA;QACA;;QAEA;QACA;QACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBACA3B;gBAAA;gBAAA,OACA;cAAA;gBAAAH;gBACA;gBACAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;EACA;EACA+B;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;MACA;QAAA;QAAA;MAAA;IACA;IACAC;MAAA;MACA;QAAAC;MAAA;IACA;IACAC;MACA;QACAC;QACAC;MACA;QAAA;QACA;UACAD;UACAE;QACA;QACA;UACAD;QACA;MACA;MACA;QACAC;QACAF;QACAC;MACA;IACA;IACAE;MACA;QAAA1C;MAAA;IACA;EACA;EACA2C;IACA5D;MACA6D;QACA;UACA;QACA;MACA;IACA;EACA;EACAC;IAAA;IACA;IACA;MACA;IACA;IACA;IACA;IACA;IACA;IACAC;IAEAf;EACA;EACAgB;IACA;IACA;MACA;IACA;EACA;AACA;AAAA,2B","file":"component/square/waterfall.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./waterfall.vue?vue&type=template&id=37ce5880&scoped=true&\"\nvar renderjs\nimport script from \"./waterfall.vue?vue&type=script&lang=js&\"\nexport * from \"./waterfall.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"37ce5880\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"component/square/waterfall.vue\"\nexport default component.exports","export * from \"-!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./waterfall.vue?vue&type=template&id=37ce5880&scoped=true&\"","import mod from \"-!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./waterfall.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Hbuilder-a/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./waterfall.vue?vue&type=script&lang=js&\"","<template>\r\n  <scroll-view class=\"waterfall-container\" @scroll=\"handleScroll\">\r\n    <view class=\"waterfall-list\" :style=\"listStyle\">\r\n      <view \r\n        v-if=\"isShow\"\r\n        class=\"waterfall-item\"\r\n        v-for=\"{item , style , imageHeight} in renderList\"\r\n        :key = \"item.id\"\r\n        :style = \"style\"\r\n        >\r\n        <slot name=\"item\" :item=\"item\" :imageHeight=\"imageHeight\"></slot>\r\n      </view>\r\n      <view id=\"temporary-list\" v-else>\r\n        <view v-for=\"(item , style , imageHeight) in temporaryList\" :style=\"style\">\r\n          <slot name=\"item\" :item=\"item\" :imageHeight=\"imageHeight\"></slot>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </scroll-view>\r\n</template>\r\n\r\n<script>\r\nimport { rafThrottle , debounce } from \"../../utils/tool.js\"\r\n\texport default {\r\n    props:{\r\n      props:{\r\n        type:Object,\r\n        required:true\r\n      }\r\n    },\r\n\t\tdata() {\r\n\t\t\treturn {\r\n        item:{},\r\n        imageHeight:0,\r\n        //列表数据源\r\n        dataState:{\r\n          loading:false,\r\n          isFinish:false,\r\n          currentPage:1,\r\n          list:[]\r\n        },\r\n        //滚动的viewList的宽高\r\n        scrollState:{\r\n          viewWidth:0,\r\n          viewHeight:0,\r\n          start:0\r\n        },\r\n        //列数据源堆栈\r\n        queueState : {\r\n          queue:new Array(this.props.column).fill(0).map(()=>({list:[],height:0})),\r\n          len:0\r\n        },\r\n        isShow : false,\r\n        containerRef : {},\r\n        //监听滚动元素的对象实例\r\n        resizeObserver:null,\r\n        //带样式渲染数据实例\r\n        temporaryList:null,\r\n        //存储每个瀑布流下Item的Size,以id为键,带样式的数据渲染项为Item\r\n        itemSizeInfo:new Map()\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\r\n\t\t},\r\n\t\tmethods: {\r\n      //监听滚动并调整大小方法\r\n      handleResize(){\r\n        console.log(\"调整Size\");\r\n        this.initScrollState()\r\n        this.reComputedQueue()\r\n      },\r\n      //计算每一项的尺寸,并且建造一个新的Map返回给itemSizeInfo\r\n      setItemSize(){\r\n        this.itemSizeInfo = this.dataState.list.reduce((pre,current)=>{\r\n          const itemWidth = Math.floor((this.scrollState.viewWidth - (this.props.column -1) * this.props.gap) / this.props.column)\r\n          const rect = this.itemSizeInfo.get(current.id)\r\n          pre.set(current.id,{\r\n            width:itemWidth,\r\n            height:rect?rect.height:0,\r\n            imageHeight:Math.floor((itemWidth * current.height)/current.width)\r\n          })\r\n          return pre\r\n        },new Map())\r\n      },\r\n      //更新瀑布流item项的高?\r\n      updateItemSize(){\r\n        this.temporaryList.forEach(({item,h})=>{\r\n          const rect = this.itemSizeInfo.get(item.id)\r\n          this.itemSizeInfo.set(item.id,{...rect,height:h})\r\n        })\r\n      },\r\n      //将一个新数据,添加进渲染数据流栈\r\n      addInQueue(size = this.props.enterSize){\r\n        for(let i = 0 ; i < size ; i++){\r\n          const minIndex = this.computedHeight.minIndex\r\n          //找到当前的最短高度列\r\n          const currentColumn = this.queueState.queue[minIndex]\r\n          //找到当前列下的数据数组的最后一个有效项的下标\r\n          const before = currentColumn.list[currentColumn.list.length - 1]\r\n          const dataItem = this.dataState.list[this.queueState.len]\r\n          const item = this.generatorItem(dataItem,before,minIndex)\r\n          //将新数据推入至最短高度列?\r\n          currentColumn.list.push(item)\r\n          currentColumn.height = item.y\r\n          this.queueState.len+1\r\n        }\r\n      },\r\n      generatorItem(item,before,index){\r\n        const rect = this.itemSizeInfo.get(item.id)\r\n        const width = rect.width\r\n        const height = rect.height\r\n        const imageHeight = rect.imageHeight\r\n        let y = 0\r\n\r\n        //如果它不是该列第一个item,那么其y - item距离container顶部的距离 , 就应该有变化\r\n        if(before)\r\n          y = before.y + before.h + props.gap\r\n        //返回一个包含乐样式的渲染数据对象\r\n        return {\r\n          item,\r\n          y,\r\n          h:height,\r\n          imageHeight,\r\n          style:{\r\n            width:`${width}px`,\r\n            height:`${height}px`,\r\n            transform:`translate3d(${index === 0 ? 0 : (width+this.props.gap)* index}px,${y}px,0`\r\n          }\r\n        }\r\n      },\r\n      //加载列表请求,若有新的数据则push进数据源\r\n      async loadDataList(){\r\n        if(this.dataState.isFinish) return \r\n        this.dataState.loading = true\r\n        const list = await this.props.request(this.dataState.currentPage++ , this.props.pageSize);\r\n        if(!list.length){\r\n          this.dataState.isFinish = true\r\n          return\r\n        }\r\n        this.dataState.list.push(...list);\r\n        this.dataState.loading = false\r\n        return list.length\r\n      },\r\n      handleScroll(){\r\n        //这里的containerRef应该改为微信获取类似DOM元素的效果\r\n        const { scrollTop ,clientHeight } = this.containerRef\r\n        this.scrollState.start = scrollTop\r\n        if(!this.dataState.loading && this.hasMoreData){\r\n          this.loadDataList().then((len)=>{\r\n            len && this.setItemSize();\r\n            len && this.mountTemporaryList()\r\n          })\r\n          return\r\n        }\r\n        if(scrollTop + clientHeight > this.computedHeight.minHeight ){\r\n          this.mountTemporaryList()\r\n        }\r\n      },\r\n      reComputedQueue(){\r\n        this.setItemSize()\r\n        this.queueState.queue = new Array(this.props.column).fill(0).map(()=>({list:[],height:0}))\r\n        this.queueState.len = 0\r\n        this.containerRef.scrollTop = 0\r\n        this.mountTemporaryList(this.props.pageSize)\r\n      },\r\n      mountTemporaryList(size){\r\n        if(!this.hasMoreData)\r\n          return\r\n        this.isShow = false\r\n        for(let i=0;i<size;i++){\r\n          const item = this.dataState.list[this.queueState.len+1]\r\n          if(!item)\r\n           break;\r\n          const rect = this.itemSizeInfo.get(item.id)\r\n          this.temporaryList.push({\r\n            item,\r\n            y:0,\r\n            h:0,\r\n            imageHeight:rect.imageHeight,\r\n            style:{\r\n              width:`${rect.width}px`\r\n            }\r\n          })\r\n        }\r\n\r\n          this.$nextTick(() => {\r\n          const query = uni.createSelectorQuery().in(this); // 创建选择器查询\r\n          query.select(\"#temporary-list\").boundingClientRect((rect) => {\r\n            const list = this.$refs.temporaryList;  // 获取 DOM 元素\r\n            if (list) {\r\n              // 获取每个子项的高度并更新 temporaryList\r\n              Array.from(list.children).forEach((item, index) => {\r\n                const rect = item.getBoundingClientRect();\r\n                this.temporaryList[index].h = rect.height;\r\n              });\r\n            }\r\n          }).exec();\r\n\r\n          // 更新界面状态\r\n          this.isShow = true;\r\n          this.updateItemSize();\r\n          this.addInQueue(this.temporaryList.length);\r\n          this.temporaryList = [];  // 清空临时列表\r\n        });\r\n      },\r\n      initScrollState(){\r\n        this.scrollState.viewWidth = this.containerRef.clientWidth;\r\n        this.scrollState.viewHeight = this.containerRef.clientHeight;\r\n        this.scrollState.start = this.containerRef.scrollTop;\r\n      },\r\n      async init(){\r\n        this.initScrollState();\r\n        resizeObserver.observe(this.containerRef);\r\n        const len = await this.loadDataList();\r\n        this.setItemSize();\r\n        len && this.mountTemporaryList(len);\r\n      }\r\n\t\t},\r\n    computed:{\r\n      hasMoreData(){\r\n        return this.queueState.len<this.dataState.list.length\r\n      },\r\n      end(){\r\n        return this.scrollState.viewHeight + this.scrollState.start\r\n      },\r\n      cardList(){\r\n        //reduce - 将二维数组转换成一维数组,回调函数的第二个参数是pre的初始值\r\n        return this.queueState.queue.reduce((pre,{list})=> pre.concat(list),[])\r\n      },\r\n      renderList(){\r\n        return this.cardList.value.filter((i)=>{ i.h + i.y> this.scrollState.start && i.y<this.end})\r\n      },\r\n      computedHeight(){\r\n        let minIndex = 0,\r\n        minHeight = Infinity,\r\n        maxHeight = -Infinity;\r\n        this.queueState.queue.forEach(({ height }, index) => {\r\n          if (height < minHeight) {\r\n            minHeight = height;\r\n            minIndex = index;\r\n          }\r\n          if (height > maxHeight) {\r\n            maxHeight = height;\r\n          }\r\n        });\r\n        return {\r\n          minIndex,\r\n          minHeight,\r\n          maxHeight,\r\n        };\r\n      },\r\n      listStyle(){\r\n        return {height:`${this.computedHeight.maxHeight}`}\r\n      }\r\n    },\r\n    watch:{\r\n      props:{\r\n        handler(newProps,oldProps){\r\n          if(newProps.column !== oldProps.column){\r\n            this.handleResize()\r\n          }\r\n        }\r\n      }\r\n    },\r\n    mounted(){\r\n      //小程序不支持该监听滚动元素事件,需要修改一下\r\n      this.resizeObserver = new ResizeObserver(()=>{\r\n        this.handleResize()\r\n      })\r\n      const debounceHandleResize = debounce(this.handleResize)\r\n      //为获取到的元素绑定该事件\r\n      const throttledHandleScroll = rafThrottle(this.handleScroll)\r\n      const container = wx.createSelectorQuery().select('#container');\r\n      container.on('scroll', throttledHandleScroll);\r\n\r\n      init()\r\n    },\r\n    beforeDestroy() {\r\n    // 在组件销毁之前取消 ResizeObserver 对 container 的观察\r\n      if (this.resizeObserver && this.$refs.container) {\r\n        this.resizeObserver.unobserve(this.$refs.container);\r\n      }\r\n    } \r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n</style>\r\n"],"sourceRoot":""}
>>>>>>> 2ecb0c07bfe34cb7dadd2fe43ee1271a6726332b
